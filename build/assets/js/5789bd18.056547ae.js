"use strict";(globalThis.webpackChunkdocs_neuralk=globalThis.webpackChunkdocs_neuralk||[]).push([[3167],{2036:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"plot_categorization","title":"plot_categorization","description":"This example shows how to use the NeuralkAI SDK to predict product categories.","source":"@site/docs/plot_categorization.md","sourceDirName":".","slug":"/plot_categorization","permalink":"/docs/plot_categorization","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Core concepts","permalink":"/docs/core_concepts"},"next":{"title":"Classification module","permalink":"/docs/plot_two_moon_classification"}}');var r=n(4848),s=n(8453);const i={},o="NeuralkAI Categorization  Example",l={},c=[{value:"Loading username and password",id:"loading-username-and-password",level:2},{value:"Uploading datasets into a project",id:"uploading-datasets-into-a-project",level:2},{value:"Fitting a product categorization workflow",id:"fitting-a-product-categorization-workflow",level:2},{value:"Using the fitted workflow",id:"using-the-fitted-workflow",level:2},{value:"Downloading the prediction results",id:"downloading-the-prediction-results",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("a",{id:"sphx-glr-auto-examples-plot-categorization-py"}),"\n",(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"neuralkai-categorization--example",children:"NeuralkAI Categorization  Example"})}),"\n",(0,r.jsxs)(t.p,{children:["This example shows how to use the NeuralkAI SDK to predict product categories.\nWe use a subset of the\n",(0,r.jsx)(t.a,{href:"https://github.com/BestBuyAPIs/open-data-set",children:"Best Buy dataset"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:"import os\nimport tempfile\nfrom pathlib import Path\n\nimport polars as pl\n\nfrom neuralk import Neuralk\nfrom neuralk.datasets import best_buy\n"})}),"\n",(0,r.jsx)(t.h2,{id:"loading-username-and-password",children:"Loading username and password"}),"\n",(0,r.jsxs)(t.p,{children:["To connect to the Neuralk API, we need to authenticate. Here we read the\nusername and password from environment variables. We first attempt to load\nany variables set in a ",(0,r.jsx)(t.a,{href:"https://github.com/theskumar/python-dotenv",children:"dotenv"}),"\nfile."]}),"\n",(0,r.jsxs)(t.p,{children:["Then, we can create a ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk",children:(0,r.jsx)(t.code,{children:"Neuralk"})})," client to connect to the API."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'try:\n    from dotenv import load_dotenv\n\n    load_dotenv()\nexcept ImportError:\n    print("python-dotenv not installed, skipping .env loading")\n\nuser = os.environ.get("NEURALK_USER")\npassword = os.environ.get("NEURALK_PASSWORD")\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:"client = Neuralk(user, password)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"uploading-datasets-into-a-project",children:"Uploading datasets into a project"}),"\n",(0,r.jsxs)(t.p,{children:["All the datasets and the analyses we run on them belong to a project. Those\nare managed through the ",(0,r.jsx)(t.code,{children:".projects"})," attribute of the ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk",children:(0,r.jsx)(t.code,{children:"Neuralk"})}),"\nclient."]}),"\n",(0,r.jsxs)(t.p,{children:["Here we retrieve the ",(0,r.jsx)(t.code,{children:'"best_buy"'})," project, creating it if it does not exist\nyet. Note that we can get the list of all projects accessible from our client\nwith ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.projects.get_list",children:(0,r.jsx)(t.code,{children:"Neuralk.projects.get_list"})})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'def get_or_create_project(name):\n    project = next((p for p in client.projects.get_list() if p.name == name), None)\n    if project is None:\n        project = client.projects.create(name)\n    return project\n\n\nproject = get_or_create_project("best_buy")\n'})}),"\n",(0,r.jsxs)(t.p,{children:["The Neuralk SDK package provides a few example datasets with which we can try\nout the API in the ",(0,r.jsx)(t.code,{children:"datasets"})," module. We obtain the path to a Parquet\nfile containing a (training) subset of the Best Buy data."]}),"\n",(0,r.jsx)(t.p,{children:"to make the example run fast we use a small subset, pass subsample=False to\nrun on full dataset"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'local_dataset = best_buy(subsample=True)\npl.read_parquet(local_dataset["train_path"])\n'})}),"\n",(0,r.jsxs)(t.p,{children:["To run an analysis, we need to create a dataset on the platform. Those are\nmanaged through the ",(0,r.jsx)(t.code,{children:".datasets"})," attribute of the ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk",children:(0,r.jsx)(t.code,{children:"Neuralk"})})," client."]}),"\n",(0,r.jsxs)(t.p,{children:["The data is uploaded to our project with ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.datasets.create",children:(0,r.jsx)(t.code,{children:"Neuralk.datasets.create"})}),". We\npass the project object, a name for the dataset, and the local path of the\nCSV or Parquet file (in this case, Parquet) to upload."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'train_dataset = client.datasets.create(\n    project, "best_buy_train", local_dataset["train_path"]\n)\n\nclient.datasets.wait_until_complete(train_dataset, verbose=True)\n'})}),"\n",(0,r.jsx)(t.h2,{id:"fitting-a-product-categorization-workflow",children:"Fitting a product categorization workflow"}),"\n",(0,r.jsx)(t.p,{children:"The next step is to fit a workflow on the training data. Later, we will be\nable to use it to categorize new products for which we do not have a ground\ntruth."}),"\n",(0,r.jsxs)(t.p,{children:["Analyses are managed through the ",(0,r.jsx)(t.code,{children:"analysis"})," attribute of the\n",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk",children:(0,r.jsx)(t.code,{children:"Neuralk"})})," client. We launch the fit of our workflow by creating a\n\u201ccategorization fit\u201d analysis with\n",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_fit",children:(0,r.jsx)(t.code,{children:"Neuralk.analysis.create_categorization_fit"})}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'analysis_fit = client.analysis.create_categorization_fit(\n    train_dataset,\n    "best_buy_fit",\n    target_columns=[\n        "neuralk categorization level 0",\n        "neuralk categorization level 1",\n        "neuralk categorization level 2",\n        "neuralk categorization level 3",\n        "neuralk categorization level 4",\n    ],\n)\nprint("Categorization fit analysis created:", analysis_fit)\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_fit",children:(0,r.jsx)(t.code,{children:"Neuralk.analysis.create_categorization_fit"})})," returns immediately an\n",(0,r.jsx)(t.code,{children:"Analysis"})," object that represents the analysis we have just launched.\nThis analysis has not finished running yet. Depending on our needs, we may\nwant to continue with other tasks or finish our script at this point. But in\nthis example, we want to wait and use the fitted model once it is ready."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.analysis.wait_until_complete",children:(0,r.jsx)(t.code,{children:"Neuralk.analysis.wait_until_complete"})})," allows us to pause the execution\nof our script and wait for the analysis to finish (or error). It returns a\nnew ",(0,r.jsx)(t.code,{children:"Analysis"})," object, corresponding to the same analysis but with an\nupdated status."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:"analysis_fit = client.analysis.wait_until_complete(analysis_fit, verbose=True)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"using-the-fitted-workflow",children:"Using the fitted workflow"}),"\n",(0,r.jsx)(t.p,{children:"Now that we have fitted our categorizer, we can use it for some new, unseen\nproducts."}),"\n",(0,r.jsx)(t.p,{children:"We start by creating a new dataset to upload the unseen data."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'test_dataset = client.datasets.create(\n    project, "best_buy_train", local_dataset["test_path"]\n)\n\nclient.datasets.wait_until_complete(test_dataset, verbose=True)\n'})}),"\n",(0,r.jsxs)(t.p,{children:["We can now apply the fitted workflow to the ",(0,r.jsx)(t.code,{children:"test_dataset"})," we just created.\nThis is done with ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_predict",children:(0,r.jsx)(t.code,{children:"Neuralk.analysis.create_categorization_predict"})}),", to\nwhich we pass the new dataset, a name for the analysis, and the\n",(0,r.jsx)(t.code,{children:"Analysis"})," object resulting from fitting the model we wish to use now."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'analysis_predict = client.analysis.create_categorization_predict(\n    test_dataset, "best_buy_predict", analysis_fit\n)\nprint("Categorization fit analysis created:", analysis_fit)\n'})}),"\n",(0,r.jsx)(t.p,{children:"As before, we wait until the analysis finishes before continuing the example."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:"analysis_predict = client.analysis.wait_until_complete(analysis_predict, verbose=True)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"downloading-the-prediction-results",children:"Downloading the prediction results"}),"\n",(0,r.jsxs)(t.p,{children:["Now that our prediction analyis is complete, we want to download the\npredictions. This is done with ",(0,r.jsx)(t.a,{href:"../api-reference/generated/neuralk.Neuralk.analysis.download_results",children:(0,r.jsx)(t.code,{children:"Neuralk.analysis.download_results"})}),", to\nwhich we pass the reference to the prediction analysis whose results we want."]}),"\n",(0,r.jsx)(t.p,{children:"All the results are stored in the provided directory, from which we can load\nthem to use as we wish."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-Python",children:'with tempfile.TemporaryDirectory() as results_dir:\n    client.analysis.download_results(analysis_predict, folder_path=results_dir)\n    print("Prediction results downloaded to temporary directory")\n    results_file = next(Path(results_dir).iterdir())\n    y_pred = pl.read_parquet(results_file)\n\nprint(y_pred.shape)\n'})}),"\n",(0,r.jsx)("a",{id:"sphx-glr-download-auto-examples-plot-categorization-py"})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var a=n(6540);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);