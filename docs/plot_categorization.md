<!-- DO NOT EDIT. -->
<!-- THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY. -->
<!-- TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE: -->
<!-- "auto_examples/plot_categorization.py" -->
<!-- LINE NUMBERS ARE GIVEN BELOW. -->

<a id="sphx-glr-auto-examples-plot-categorization-py"></a>

# Neuralk-AI Categorization Example

This example shows how to use the NeuralkAI SDK to predict product categories.
We use a subset of the
[Best Buy dataset](https://github.com/BestBuyAPIs/open-data-set).

<!-- GENERATED FROM PYTHON SOURCE LINES 13-22 -->
```Python
import os
import tempfile
from pathlib import Path

import polars as pl

from neuralk import Neuralk
from neuralk.datasets import best_buy
```

<!-- GENERATED FROM PYTHON SOURCE LINES 23-32 -->

## Loading username and password

To connect to the Neuralk API, we need to authenticate. Here we read the
username and password from environment variables. We first attempt to load
any variables set in a [dotenv](https://github.com/theskumar/python-dotenv)
file.

Then, we can create a [`Neuralk`](../api-reference/generated/neuralk.Neuralk#neuralk.Neuralk) client to connect to the API.

<!-- GENERATED FROM PYTHON SOURCE LINES 34-44 -->
```Python
try:
    from dotenv import load_dotenv

    load_dotenv()
except ImportError:
    print("python-dotenv not installed, skipping .env loading")

user = os.environ.get("NEURALK_USERNAME")
password = os.environ.get("NEURALK_PASSWORD")
```

<!-- GENERATED FROM PYTHON SOURCE LINES 45-47 -->
```Python
client = Neuralk(user, password)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 48-58 -->

## Uploading datasets into a project

All the datasets and the analyses we run on them belong to a project. Those
are managed through the `.projects` attribute of the [`Neuralk`](../api-reference/generated/neuralk.Neuralk#neuralk.Neuralk)
client.

Here we retrieve the `"best_buy"` project, creating it if it does not exist
yet. Note that we can get the list of all projects accessible from our client
with [`Neuralk.projects.get_list`](../api-reference/generated/neuralk.Neuralk.projects.get_list#neuralk.Neuralk.projects.get_list)

<!-- GENERATED FROM PYTHON SOURCE LINES 61-70 -->
```Python
def get_or_create_project(name):
    project = next((p for p in client.projects.get_list() if p.name == name), None)
    if project is None:
        project = client.projects.create(name)
    return project


project = get_or_create_project("best_buy")
```

<!-- GENERATED FROM PYTHON SOURCE LINES 71-74 -->

The Neuralk SDK package provides a few example datasets with which we can try
out the API in the `datasets` module. We obtain the path to a Parquet
file containing a (training) subset of the Best Buy data.

<!-- GENERATED FROM PYTHON SOURCE LINES 76-78 -->

to make the example run fast we use a small subset, pass subsample=False to
run on full dataset

<!-- GENERATED FROM PYTHON SOURCE LINES 78-81 -->
```Python
local_dataset = best_buy(subsample=True)
pl.read_parquet(local_dataset["train_path"])
```

<!-- GENERATED FROM PYTHON SOURCE LINES 82-88 -->

To run an analysis, we need to create a dataset on the platform. Those are
managed through the `.datasets` attribute of the [`Neuralk`](../api-reference/generated/neuralk.Neuralk#neuralk.Neuralk) client.

The data is uploaded to our project with [`Neuralk.datasets.create`](../api-reference/generated/neuralk.Neuralk.datasets.create#neuralk.Neuralk.datasets.create). We
pass the project object, a name for the dataset, and the local path of the
CSV or Parquet file (in this case, Parquet) to upload.

<!-- GENERATED FROM PYTHON SOURCE LINES 90-96 -->
```Python
train_dataset = client.datasets.create(
    project, "best_buy_train", local_dataset["train_path"]
)

client.datasets.wait_until_complete(train_dataset, verbose=True)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 97-108 -->

## Fitting a product categorization workflow

The next step is to fit a workflow on the training data. Later, we will be
able to use it to categorize new products for which we do not have a ground
truth.

Analyses are managed through the `analysis` attribute of the
[`Neuralk`](../api-reference/generated/neuralk.Neuralk#neuralk.Neuralk) client. We launch the fit of our workflow by creating a
“categorization fit” analysis with
[`Neuralk.analysis.create_categorization_fit`](../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_fit#neuralk.Neuralk.analysis.create_categorization_fit).

<!-- GENERATED FROM PYTHON SOURCE LINES 110-123 -->
```Python
analysis_fit = client.analysis.create_categorization_fit(
    train_dataset,
    "best_buy_fit",
    target_columns=[
        "neuralk categorization level 0",
        "neuralk categorization level 1",
        "neuralk categorization level 2",
        "neuralk categorization level 3",
        "neuralk categorization level 4",
    ],
)
print("Categorization fit analysis created:", analysis_fit)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 124-134 -->

[`Neuralk.analysis.create_categorization_fit`](../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_fit#neuralk.Neuralk.analysis.create_categorization_fit) returns immediately an
`Analysis` object that represents the analysis we have just launched.
This analysis has not finished running yet. Depending on our needs, we may
want to continue with other tasks or finish our script at this point. But in
this example, we want to wait and use the fitted model once it is ready.

[`Neuralk.analysis.wait_until_complete`](../api-reference/generated/neuralk.Neuralk.analysis.wait_until_complete#neuralk.Neuralk.analysis.wait_until_complete) allows us to pause the execution
of our script and wait for the analysis to finish (or error). It returns a
new `Analysis` object, corresponding to the same analysis but with an
updated status.

<!-- GENERATED FROM PYTHON SOURCE LINES 136-138 -->
```Python
analysis_fit = client.analysis.wait_until_complete(analysis_fit, verbose=True)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 139-146 -->

## Using the fitted workflow

Now that we have fitted our categorizer, we can use it for some new, unseen
products.

We start by creating a new dataset to upload the unseen data.

<!-- GENERATED FROM PYTHON SOURCE LINES 148-154 -->
```Python
test_dataset = client.datasets.create(
    project, "best_buy_train", local_dataset["test_path"]
)

client.datasets.wait_until_complete(test_dataset, verbose=True)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 155-159 -->

We can now apply the fitted workflow to the `test_dataset` we just created.
This is done with [`Neuralk.analysis.create_categorization_predict`](../api-reference/generated/neuralk.Neuralk.analysis.create_categorization_predict#neuralk.Neuralk.analysis.create_categorization_predict), to
which we pass the new dataset, a name for the analysis, and the
`Analysis` object resulting from fitting the model we wish to use now.

<!-- GENERATED FROM PYTHON SOURCE LINES 161-166 -->
```Python
analysis_predict = client.analysis.create_categorization_predict(
    test_dataset, "best_buy_predict", analysis_fit
)
print("Categorization fit analysis created:", analysis_fit)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 167-168 -->

As before, we wait until the analysis finishes before continuing the example.

<!-- GENERATED FROM PYTHON SOURCE LINES 170-172 -->
```Python
analysis_predict = client.analysis.wait_until_complete(analysis_predict, verbose=True)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 173-182 -->

## Downloading the prediction results

Now that our prediction analyis is complete, we want to download the
predictions. This is done with [`Neuralk.analysis.download_results`](../api-reference/generated/neuralk.Neuralk.analysis.download_results#neuralk.Neuralk.analysis.download_results), to
which we pass the reference to the prediction analysis whose results we want.

All the results are stored in the provided directory, from which we can load
them to use as we wish.

<!-- GENERATED FROM PYTHON SOURCE LINES 184-191 -->
```Python
with tempfile.TemporaryDirectory() as results_dir:
    client.analysis.download_results(analysis_predict, folder_path=results_dir)
    print("Prediction results downloaded to temporary directory")
    results_file = next(Path(results_dir).iterdir())
    y_pred = pl.read_parquet(results_file)

print(y_pred.shape)
```

<a id="sphx-glr-download-auto-examples-plot-categorization-py"></a>
